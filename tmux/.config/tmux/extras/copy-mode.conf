# vim: ft=tmux

bind -T copy-mode-vi g switch-client -T copyModeMultiKey_g
bind -T copyModeMultiKey_g g send-keys -X history-top
bind -T copyModeMultiKey_g f if-shell -F '#{selection_active}' '' 'send-keys -X select-word' \; send-keys -X pipe "awk -F: -vNEXTLINE=\"$(tmux capture-pane -p -S $((#{copy_cursor_y} - #{scroll_position} + 1)) -E $((#{copy_cursor_y} - #{scroll_position} + 1)) | grep -o '^[0-9]\\+:')\" '{if($2!=\"\") line=\" +\"$2; else if(NEXTLINE!=\"\") line=\" +\"NEXTLINE; else line=\"\"; print \"$EDITOR \" $1 line}' | xargs -I {} tmux new-window -a -c '#{pane_current_path}' {}"

bind -T copy-mode-vi / command-prompt -i -p '(search down)' 'send-keys -X search-forward-incremental "%%%"'
bind -T copy-mode-vi ? command-prompt -i -p '(search up)' 'send-keys -X search-backward-incremental "%%%"'
bind -T copy-mode-vi : command-prompt
bind -T copy-mode-vi 0 if-shell -F '#{copy_cursor_x}' 'send-keys -X start-of-line' 'send-keys -X back-to-indentation'
bind -T copy-mode-vi $ send-keys -X end-of-line
bind -T copy-mode-vi v if-shell -F '#{selection_active}' 'send-keys -X clear-selection' 'send-keys -X begin-selection'
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle \; send-keys -X begin-selection
bind -T copy-mode-vi C-o display-popup -d '#{pane_current_path}' -h 90% -w 95% -E 'lf -last-dir-path="$HOME/.cache/lf_dir"'
bind -T copy-mode-vi Escape if-shell -F '#{selection_active}' 'send-keys -X clear-selection' 'send-keys -X cancel'

bind -T copy-mode-vi i switch-client -T copyModeMultiKey_i
bind -T copyModeMultiKey_i w send-keys -X select-word
bind -T copyModeMultiKey_i W send-keys -X clear-selection \; send-keys -X previous-space \; send-keys -X begin-selection \; send-keys -X next-space-end
bind -T copyModeMultiKey_i b send-keys -X clear-selection \; send-keys -X jump-to-backward '(' \; send-keys -X begin-selection \; send-keys -X jump-to-forward ')'
bind -T copyModeMultiKey_i ( send-keys -X clear-selection \; send-keys -X jump-to-backward '(' \; send-keys -X begin-selection \; send-keys -X jump-to-forward ')'
bind -T copyModeMultiKey_i ) send-keys -X clear-selection \; send-keys -X jump-to-backward '(' \; send-keys -X begin-selection \; send-keys -X jump-to-forward ')'
bind -T copyModeMultiKey_i B send-keys -X clear-selection \; send-keys -X jump-to-backward '{' \; send-keys -X begin-selection \; send-keys -X jump-to-forward '}'
bind -T copyModeMultiKey_i \{ send-keys -X clear-selection \; send-keys -X jump-to-backward '{' \; send-keys -X begin-selection \; send-keys -X jump-to-forward '}'
bind -T copyModeMultiKey_i \} send-keys -X clear-selection \; send-keys -X jump-to-backward '{' \; send-keys -X begin-selection \; send-keys -X jump-to-forward '}'
bind -T copyModeMultiKey_i [ send-keys -X clear-selection \; send-keys -X jump-to-backward '[' \; send-keys -X begin-selection \; send-keys -X jump-to-forward ']'
bind -T copyModeMultiKey_i ] send-keys -X clear-selection \; send-keys -X jump-to-backward '[' \; send-keys -X begin-selection \; send-keys -X jump-to-forward ']'
bind -T copyModeMultiKey_i < send-keys -X clear-selection \; send-keys -X jump-to-backward '<' \; send-keys -X begin-selection \; send-keys -X jump-to-forward '>'
bind -T copyModeMultiKey_i > send-keys -X clear-selection \; send-keys -X jump-to-backward '<' \; send-keys -X begin-selection \; send-keys -X jump-to-forward '>'
bind -T copyModeMultiKey_i ` send-keys -X clear-selection \; send-keys -X jump-to-backward '`' \; send-keys -X begin-selection \; send-keys -X jump-to-forward '`'
bind -T copyModeMultiKey_i \' send-keys -X clear-selection \; send-keys -X jump-to-backward "'" \; send-keys -X begin-selection \; send-keys -X jump-to-forward "'"
bind -T copyModeMultiKey_i \" send-keys -X clear-selection \; send-keys -X jump-to-backward '"' \; send-keys -X begin-selection \; send-keys -X jump-to-forward '"'
bind -T copyModeMultiKey_i l send-keys -X clear-selection \; send-keys -X back-to-indentation \; send-keys -X begin-selection \; send-keys -X end-of-line \; send-keys -X cursor-left \; send-keys -X other-end
